<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Digi</title>
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="botchat.css" rel="stylesheet" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <body style="background:#fd0 url('http://new.digi.com.my/cs/site_template/digi/images/digi-pattern.png');">			




<!-- Remove for Production -->
<style type="text/css">
.password-container {
  z-index: 2;
  height: 100%;
  width: 100%;
  background-color: #fd0;	
  text-align: center;
  position: fixed;
  margin: -8px;
}
	.password-wrapper {
	  z-index: 3;
	  height: 300px;
	  width: 360px;
	  top: 50%;
	  left: 50%;
	  margin-top: -150px;
	  margin-left: -180px;
	  background-color: #ffffff;	
	  box-shadow: 1px 2px 10px rgba(100, 100, 100, .3);
	  position:fixed;
	  font-family: 'Roboto', sans-serif;
	  text-align: center;
	  font-size: 23px;
	}
	.password-form-control {
		position: relative;
		font-size: 16px;
		padding: 10px;
		float: left;
		margin-left: 22px;
		width: 300px;
	}
</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <div class="password-container" id="passwordcontainer">
        <div class="password-wrapper">
            <h3 class="password-form-signin-heading">Please Sign In</h3>

			<div>
            	<input id="username" type="text" class="password-form-control" name="Username" placeholder="Username" required="" autofocus="" />
			</div>
			<div>
				<input id="password" type="password" class="password-form-control" name="Password" placeholder="Password" required="" />
			</div>

			<div>
				<button id="login_submit" class="wc-popup-button" type="button">Login</button> 
				<button id="login_cancel" class="wc-popup-button" type="button">Cancel</button> 
			</div>
            
            
        </div>
    </div>
    <script type="text/javascript">
        $(function () {

            $("#login_submit").on("click", function () {
                verify_login($("#username").val(), $("#password").val());
            });
            $("#login_cancel").on("click", function () {
				window.location.replace("http://www.digi.com.my");  
            });

            function verify_login(username,password) {
                command = {};
                command["command"] = "bot_user_login";
                command["username"] = username;
                command["password"] = password

                $.ajax({
                    type: "POST",
                    url: 'https://digibid.azurewebsites.net/action.ashx?action=json',
                    data: {
                        data: JSON.stringify(command)
                    },
                    cache: false,
                    async: true,
                    timeout: 10000,
                    success: function (data) {
                        if (data.results.status == '0') {
							$("#passwordcontainer").hide();

							var form = new FormData();
							form.append("data", "{\"command\": \"update_chat_log\",\"auth_key\": \"a6hea2\",\"chat_id\": \"login\",\n\"dialog_id\":\"login-success\",\"dialog_state\":\"1\",\"dialog_type\":\"text\",\"dialog_input\":\"\",\"chat_log\": \"username:"+username+"\"}");

							var settings = {
							  "async": true,
							  "url": "https://digibid.azurewebsites.net/action.ashx?action=json",
							  "method": "POST",
							  "processData": false,
							  "contentType": false,
							  "mimeType": "multipart/form-data",
							  "data": form
							}
							$.ajax(settings).done(function (response) {
							  console.log(response);
							});								
							
                        } else {
							var form = new FormData();
							form.append("data", "{\"command\": \"update_chat_log\",\"auth_key\": \"a6hea2\",\"chat_id\": \"login\",\n\"dialog_id\":\"login-fail\",\"dialog_state\":\"1\",\"dialog_type\":\"text\",\"dialog_input\":\"\",\"chat_log\": \"username:"+username+"\"}");

							var settings = {
							  "async": true,
							  "url": "https://digibid.azurewebsites.net/action.ashx?action=json",
							  "method": "POST",
							  "processData": false,
							  "contentType": false,
							  "mimeType": "multipart/form-data",
							  "data": form
							}						
							$.ajax(settings).done(function (response) {
							  console.log(response);
							});
                            alert("Wrong Username OR password");
							window.location.replace("http://www.digi.com.my");
						}
                    },
                    error: function (data) {
						window.location.replace("http://www.digi.com.my");
					}
                });
            }

        });
    </script>   
<!-- Remove for Production -->







		<div id="wc-popup-url" class="wc-popup">
			<div class="wc-popup-window">
				<div style="padding: 40px;">
					<h3>You will be redirected to Digi Website</h3>
					Do you wish to continue? 
					<br>
					<span> 
						<a id="wc-popup-button-ok" href="http://bot.digi.com.my" target="_blank"><button class="wc-popup-button" onclick="$('#wc-popup-url').fadeOut(200);">Yes</button></a>
						<button id="wc-popup-button-cancel" class="wc-popup-button" onclick="$('#wc-popup-url').fadeOut(200);" >Cancel</button> 
					</span>
				</div>
			</div>
		</div>

		<div id="wc-popup-feedback" class="wc-popup">
			<div class="wc-popup-window">
				<div class="wc-popup-window-header">We appreciate your feedback</div>

				<div class="wc-popup-window-body">
					How would you rate our Chat Service? 

					<b><span id="popup-feedback-comment"></span></b>
					<form id="feedbackForm">
						<div>
							<fieldset id="popup-feedback-stars" class="rating">
								<input type="radio" id="star5" name="rating" value="5" checked="checked" /><label class = "full" for="star5" title="☆☆☆☆☆ - Awesome"></label>
								<input type="radio" id="star4" name="rating" value="4" /><label class = "full" for="star4" title="☆☆☆☆ - Pretty good"></label>
								<input type="radio" id="star3" name="rating" value="3" /><label class = "full" for="star3" title="☆☆☆ - OK"></label>
								<input type="radio" id="star2" name="rating" value="2" /><label class = "full" for="star2" title="☆☆ - Need Improvement"></label>
								<input type="radio" id="star1" name="rating" value="1" /><label class = "full" for="star1" title="☆ - Not Helpful"></label>
							</fieldset>

							<textarea rows="3" class="form-control wc-feedback-text" id="popup-feedback-remark"  name="survey-text" placeholder="Enter your feedback here" ></textarea>
						</div>
						<br><br><br>
						<button id="wc-popup-feedback-ok" class="wc-popup-button" type="button" onClick='submitFeedback()'>Submit</button> 
						<button id="wc-popup-feedback-cancel" class="wc-popup-button" type="button" onClick='$("#wc-popup-feedback").fadeOut(200);'>Cancel</button> 
					</form>				
				</div>
			</div>
		</div>

		<div id="wc-popup-feedback-thankyou" class="wc-popup">
			<div class="wc-popup-window">
				<div class="wc-popup-window-header"></div>

				<div class="wc-popup-window-body">
					Thank you for your feedback!!
				</div>
			</div>
		</div>
       
        <div>
            <div id="BotChatGoesHere"/>
            <div style="clear:both;"/>

<!--
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
-->
			<script>
				var botName="Digi";
				var botImage="http://bot.digi.com.my/images/start-logo.PNG";
				var botAvatar="http://bot.digi.com.my/images/digi-avatar.png";
				var botTyping="http://bot.digi.com.my/images/typingstatus.png";
			</script>
			<script src="botchat.js"> </script>
			<script src="digihelper.js"> </script>   


			<script>
				var now = new Date();

				// display offline page, if requested to
				<%if (process.env.OFFLINE == '1') { %>
					window.location.replace("http://bot.digi.com.my/offline.html");
				<% } %>

				
				// display offline page, all the time
				// EXCEPT display BOT in 9pm-10pm in April 2017
				if(now.getHours()<21) {         //WHITELIST 9pm-12pm for chatbot                
					<%if (process.env.DEVELOPMENT !== '1') { %>
						window.location.replace("http://new.digi.com.my/webchat");
					<% } %>
				}
				// else, launch Chatbot
				BotChat.App({
					directLine: {
						token: "<%= token %>"
					},
					user: { id: 'Me' },
					bot: { id: 'aura' },
				}, document.getElementById("BotChatGoesHere"));
			</script>
		</div>











   
   
   
    </body>
</html>
